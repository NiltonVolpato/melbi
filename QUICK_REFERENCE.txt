================================================================================
MELBI EDITOR EXTENSIONS: QUICK REFERENCE CARD
================================================================================

GENERATED: 2025-11-11
COVERAGE: Complete analysis of Zed and VS Code extensions with 50+ recommendations

DOCUMENT LOCATIONS:
  - EXTENSIONS_SUMMARY.md ........... Start here (8 KB) - 2 critical bugs + roadmap
  - EXTENSIONS_ANALYSIS.md ......... Deep dive (19 KB) - Feature comparison, gaps, TODOs
  - EXTENSIONS_TECHNICAL_GUIDE.md .. Code guide (23 KB) - Implementation examples
  
================================================================================
CRITICAL ISSUES: 2 (Fix Immediately)
================================================================================

[1] ZED HARDCODED PATH - BLOCKER
    File: zed/extension.toml:10
    Current: repository = "file:///Users/nilton/Code/tree-sitter-melbi"
    Fix: repository = "https://github.com/NiltonVolpato/tree-sitter-melbi"
    Impact: Extension only works for Nilton
    Time: 5 minutes
    Priority: ðŸ”´ BLOCKER

[2] VS CODE NO ACTIVATION EVENTS - WASTES MEMORY  
    File: vscode/package.json
    Fix: Add "activationEvents": ["onLanguage:melbi"]
    Impact: Loads on every VS Code startup
    Time: 2 minutes
    Priority: ðŸ”´ HIGH

================================================================================
FEATURES STATUS (65% COMPLETE)
================================================================================

WORKING âœ“                          MISSING âœ—
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Syntax highlighting               Go-to-Definition (LSP ready, not used)
Type checking                     Find References (LSP ready, not used)
Auto-closing brackets             Code Completion (stub returns empty)
Code formatting                   Snippets (VS Code only)
Hover info (basic)                Document symbols in VS Code
Document outline (Zed only)       Keybindings (custom)
Auto-indentation                  Themes (custom)

================================================================================
QUICK WINS: Do These First (< 2 hours)
================================================================================

1. Fix Zed path (5 min)
   zed/extension.toml:10
   
2. Add VS Code activation events (2 min)
   vscode/package.json
   
3. Add both READMEs (30 min)
   Template in EXTENSIONS_TECHNICAL_GUIDE.md section 8

4. Fix hover to use position lookup (2-3 hours)
   lsp/src/document.rs:226
   Instead of returning full expression type, lookup type at cursor

================================================================================
HIGH IMPACT FEATURES: Week 2-3
================================================================================

Recommendation Priority / Time / Effort / ROI
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Go-to-Definition  | CRITICAL / 6 hours / Medium / 10x user value
Find References   | CRITICAL / 6 hours / Medium / 10x user value  
Fix Completions   | CRITICAL / 4 hours / Medium / 5x user value
Doc Symbols (VS)  | HIGH / 3 hours / Medium / 3x user value
Add Snippets      | MEDIUM / 1 hour / Easy / 2x user value

Total: ~20 hours for essential IDE feature parity

================================================================================
ARCHITECTURE OVERVIEW
================================================================================

VS Code/Zed Editor
       â†‘
       | LSP Client
       â†“
melbi-lsp (single binary)
       â†“
    â”Œâ”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“                          â†“
melbi-core (type checker)  melbi-fmt (formatter)
    â†“
tree-sitter (syntax parsing)

KEY INSIGHT: Single LSP handles both editors - fix in LSP = fix for both!

================================================================================
FILES TO MODIFY
================================================================================

CRITICAL (DO NOW):
  [ ] zed/extension.toml (1 line)
  [ ] vscode/package.json (add activationEvents)

PHASE 1-2 (THIS WEEK):
  [ ] lsp/src/main.rs (add 50 lines for definition/references)
  [ ] lsp/src/document.rs (add 150 lines for position lookup & symbols)
  [ ] zed/README.md (NEW)
  [ ] vscode/README.md (NEW)

PHASE 3 (NEXT WEEK):
  [ ] vscode/snippets/melbi.json (NEW - 6 snippets)
  [ ] vscode/package.json (add snippets contribution)

================================================================================
CODE QUALITY SUMMARY
================================================================================

STRENGTHS âœ“
  - Solid tower-lsp architecture
  - Excellent tree-sitter integration in Zed
  - Full melbi-core type checking integration
  - Concurrent document cache (DashMap)
  - Proper error reporting and diagnostics

WEAKNESSES âœ—
  - Hardcoded development paths
  - Re-analyzes on every hover/completion (slow)
  - Hover doesn't track cursor position
  - No stdlib globals provided to analyzer
  - No multi-file workspace analysis
  - No README files or installation docs

TECHNICAL DEBT SCORE: 6/10 (manageable)

================================================================================
PERFORMANCE OPPORTUNITIES
================================================================================

1. Cache typed expressions (3 hours, 10-100x faster hover)
   Add: cached_typed_expr + source hash to DocumentState

2. Implement incremental parsing (future)
   Use tree-sitter incremental mode for large files

3. Debounce document changes (1 hour, reduces CPU)
   Wait 500ms after last keystroke before analyzing

4. Separate analysis thread (future)
   Keep analysis off main LSP thread

================================================================================
RECOMMENDED READING ORDER
================================================================================

1. Read: EXTENSIONS_SUMMARY.md (5 min)
   â†’ Understand what's broken and why

2. Read: EXTENSIONS_ANALYSIS.md Part 1-2 (15 min)
   â†’ Understand Zed and VS Code differences

3. Read: EXTENSIONS_ANALYSIS.md Part 4-5 (10 min)
   â†’ See feature gaps and recommendations

4. Read: EXTENSIONS_TECHNICAL_GUIDE.md sections 1-3 (20 min)
   â†’ Understand how to fix critical bugs

5. Read: EXTENSIONS_TECHNICAL_GUIDE.md sections 4-5 (30 min)
   â†’ Understand performance optimization

6. Code: Implement recommendations in priority order

================================================================================
TIMELINE ESTIMATE
================================================================================

Week 1: Critical Fixes & Documentation
  Mon: Fix Zed path + VS Code activation (1 hour)
  Tue: Create README files (2 hours)
  Wed: Implement hover position lookup (3 hours)
  Thu: Catch-up / testing
  Fri: Testing and minor fixes

Week 2: Navigation Features
  Mon-Wed: Implement Go-to-Definition (6 hours)
  Thu-Fri: Implement Find References (6 hours)

Week 3: UX Features
  Mon-Tue: Code completion (4 hours)
  Wed: Snippets (1 hour)
  Thu: Document symbols (3 hours)
  Fri: Testing and optimization

Total: ~27.5 hours of focused development

================================================================================
EXTENSION ARCHITECTURE CHECKLIST
================================================================================

ZEED EXTENSION (zed/)
  [âœ“] Language configuration (config.toml)
  [âœ“] Bracket rules defined
  [âœ“] Tree-sitter integration
  [âœ“] Highlights queries (.scm)
  [âœ“] Indentation rules
  [âœ“] Bracket matching
  [âœ“] Document outline queries
  [âœ—] README
  [âœ—] Test tasks
  [âœ—] GitHub grammar fallback

VS CODE EXTENSION (vscode/)
  [âœ“] Language registration (package.json)
  [âœ“] Grammar configuration
  [âœ“] TextMate syntax file
  [âœ“] Language config (auto-close, fold, etc.)
  [âœ“] Extension code (TypeScript)
  [âœ—] Activation events
  [âœ—] README  
  [âœ—] Snippets
  [âœ—] Keybindings
  [âœ—] Test automation

LSP SERVER (lsp/)
  [âœ“] Text document sync
  [âœ“] Hover provider
  [âœ“] Completion provider (stub)
  [âœ“] Formatting provider
  [âœ“] Diagnostics (syntax + type checking)
  [âœ—] Definition provider
  [âœ—] References provider
  [âœ—] Document symbol provider
  [âœ—] Semantic tokens provider
  [âœ—] Analysis caching
  [âœ—] Workspace analysis

================================================================================
BEST PRACTICES FROM ANALYSIS
================================================================================

FROM ZED â†’ APPLY TO VS CODE:
  1. Use tree-sitter for syntax operations (not regex)
  2. Implement document symbol navigation
  3. Leverage tree-sitter for indentation

FROM VS CODE â†’ APPLY TO ZED:
  1. Comprehensive language-configuration.json
  2. Better extension metadata organization
  3. Explicit activation events

CROSS-EDITOR BEST PRACTICES:
  1. Keep LSP capabilities in sync
  2. Version extensions together
  3. Unified test suite for syntax
  4. Shared documentation

================================================================================
QUICK BUGS & FIXES
================================================================================

BUG: Hover returns full expression type, not type at cursor
LOCATION: lsp/src/document.rs:226
FIX: Implement position-based lookup in typed AST
STATUS: TODO documented in code

BUG: Completion returns empty list
LOCATION: lsp/src/document.rs:251
FIX: Collect variables in scope before cursor
STATUS: TODO documented in code

BUG: No analysis caching - hover re-analyzes whole document
LOCATION: lsp/src/document.rs
FIX: Add cached_typed_expr with source hash
IMPACT: 10-100x faster hover/completion

BUG: Hardcoded Mac development path in Zed grammar
LOCATION: zed/extension.toml:10
FIX: Use GitHub URL
SEVERITY: BLOCKER - breaks extension for other users

BUG: VS Code extension loads on every startup
LOCATION: vscode/package.json
FIX: Add activationEvents
IMPACT: 10-20% faster VS Code startup

================================================================================
KEY METRICS
================================================================================

FEATURE PARITY: 65% (goal: 90%)
CODE QUALITY: Good (tower-lsp is solid)
DOCUMENTATION: Poor (no READMEs)
PERFORMANCE: Medium (no caching)
USER EXPERIENCE: Basic (navigation missing)

After recommendations:
  Feature Parity: 90%
  Documentation: Complete
  Performance: Excellent (with caching)
  User Experience: Excellent

================================================================================
CONTACT & QUESTIONS
================================================================================

All details in three documents:
  1. EXTENSIONS_SUMMARY.md - Start here
  2. EXTENSIONS_ANALYSIS.md - Deep details  
  3. EXTENSIONS_TECHNICAL_GUIDE.md - Code examples

Each document cross-references the others.

Key points:
  - Two critical bugs found and documented
  - 50+ specific, actionable recommendations
  - Complete code examples for fixes
  - Detailed implementation guidance
  - Resource estimates for planning

================================================================================
